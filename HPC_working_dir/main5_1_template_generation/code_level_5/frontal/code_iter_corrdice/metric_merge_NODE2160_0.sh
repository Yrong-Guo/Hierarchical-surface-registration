while getopts 'n:' flag; do
  case "${flag}" in
    n) iter_num="${OPTARG}" ;;
    *)
      echo "Usage: $0 [-n iter_num]"
      exit 1
      ;;
  esac
done
iter_num_last=$((${iter_num} - 1))
wb_command -metric-math '(x0+x1+x2+x3+x4+x5+x6+x7+x8+x9+x10+x11+x12+x13+x14+x15+x16+x17+x18+x19+x20+x21+x22+x23+x24+x25+x26+x27+x28+x29+x30+x31+x32+x33+x34+x35+x36+x37+x38+x39+x40+x41+x42)/43' /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/NODE2160_${iter_num}.curv.affine.ico6.shape.gii -var x0 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/303624.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x1 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/757764.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x2 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/148941.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x3 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/158540.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x4 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/195041.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x5 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/898176.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x6 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/462139.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x7 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/116120.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x8 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/209329.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x9 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/159138.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x10 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/159138.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x11 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/303624.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x12 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/174841.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x13 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/212823.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x14 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/159441.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x15 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/441939.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x16 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/304727.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x17 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/492754.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x18 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/189349.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x19 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/233326.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x20 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/153429.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x21 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/153429.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x22 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/753150.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x23 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/783462.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x24 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/137431.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x25 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/645551.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x26 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/329844.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x27 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/352132.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x28 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/191336.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x29 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/214019.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x30 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/103010.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x31 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/255740.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x32 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/117324.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x33 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/517239.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x34 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/137532.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x35 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/105923.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x36 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/688569.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x37 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/837964.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x38 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/958976.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x39 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/214524.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x40 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/188448.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x41 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/584355.L.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii -var x42 /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/584355.R.MSM.NODE2160_${iter_num}.transformed_and_reprojected.func.gii;
wb_command -metric-merge /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/NODE2160_frontal_merged.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/303624.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/757764.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/148941.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/158540.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/195041.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/898176.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/462139.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/116120.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/209329.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/159138.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/159138.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/303624.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/174841.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/212823.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/159441.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/441939.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/304727.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/492754.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/189349.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/233326.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/153429.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/153429.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/753150.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/783462.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/137431.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/645551.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/329844.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/352132.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/191336.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/214019.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/103010.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/255740.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/117324.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/517239.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/137532.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/105923.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/688569.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/837964.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/958976.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/214524.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/188448.R.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/584355.L.frontal.ico6.shape.gii -metric /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/584355.R.frontal.ico6.shape.gii;
wb_command -metric-reduce /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/NODE2160_frontal_merged.shape.gii MAX /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/NODE2160_frontal_mask.shape.gii;

cp /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/NODE2160_${iter_num}.curv.affine.ico6.shape.gii /HPC_work_dir/corrdice_affine_mask/checkNODE2160_msmrefine/NODE2160.final.curv.affine.ico6.shape.gii

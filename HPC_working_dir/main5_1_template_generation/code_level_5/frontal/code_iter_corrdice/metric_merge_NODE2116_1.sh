while getopts 'n:' flag; do
  case "${flag}" in
    n) iter_num="${OPTARG}" ;;
    *)
      echo "Usage: $0 [-n iter_num]"
      exit 1
      ;;
  esac
done
iter_num_last=$((${iter_num} - 1))
wb_command -metric-math '(x0+x1+x2+x3+x4+x5+x6+x7+x8+x9+x10+x11+x12+x13+x14+x15+x16+x17+x18+x19+x20+x21+x22+x23+x24+x25+x26+x27+x28+x29+x30+x31+x32+x33+x34+x35+x36+x37+x38+x39)/40' /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/NODE2116_${iter_num}.curv.affine.ico6.shape.gii -var x0 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/120515.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x1 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/214019.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x2 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/148032.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x3 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/381543.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x4 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/869472.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x5 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/869472.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x6 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/149337.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x7 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/152831.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x8 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/322224.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x9 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/127933.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x10 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/156435.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x11 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/178748.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x12 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/151526.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x13 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/700634.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x14 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/231928.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x15 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/770352.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x16 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/106016.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x17 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/141422.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x18 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/150928.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x19 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/557857.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x20 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/557857.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x21 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/810439.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x22 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/650746.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x23 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/759869.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x24 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/116423.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x25 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/163432.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x26 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/469961.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x27 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/209329.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x28 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/126426.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x29 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/206323.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x30 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/164030.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x31 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/559053.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x32 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/157437.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x33 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/205119.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x34 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/161731.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x35 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/549757.R.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x36 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/154532.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x37 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/566454.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x38 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/213017.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii -var x39 /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/424939.L.MSM.NODE2116_${iter_num}.transformed_and_reprojected.func.gii;
wb_command -metric-math 'abs(x-y)' /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/difference.shape.gii -var x /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/NODE2116_${iter_num_last}.curv.affine.ico6.shape.gii -var y /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/NODE2116_${iter_num}.curv.affine.ico6.shape.gii;
diff=$(wb_command -metric-stats /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/difference.shape.gii -reduce MEAN -roi /HPC_work_dir/frontal_lobe/rotated_deformed_frontal_lobe_corrdice/NODE2116_frontal_mask.shape.gii);
echo $diff;

cp /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/NODE2116_${iter_num}.curv.affine.ico6.shape.gii /HPC_work_dir/corrdice_affine_mask/checkNODE2116_msmrefine/NODE2116.final.curv.affine.ico6.shape.gii
